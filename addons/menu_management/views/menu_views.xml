<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Actions -->
    <record id="action_menu_item" model="ir.actions.act_window">
        <field name="name">Menu Items</field>
        <field name="res_model">menu.item</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Views: Category -->
    <record id="view_menu_category_tree" model="ir.ui.view">
        <field name="name">menu.category.tree</field>
        <field name="model">menu.category</field>
        <field name="arch" type="xml">
            <list>
                <field name="sequence"/>
                <field name="name"/>
                <field name="item_count"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <record id="view_menu_category_form" model="ir.ui.view">
        <field name="name">menu.category.form</field>
        <field name="model">menu.category</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="%(action_menu_item)d" type="action" class="oe_stat_button" icon="fa-cutlery" context="{'default_category_id': id}">
                            <field name="item_count" widget="statinfo" string="Items"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="sequence"/>
                            <field name="active"/>
                            <field name="image_1920" widget="image"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Description">
                            <field name="description"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Views: Allergen -->
    <record id="view_menu_allergen_tree" model="ir.ui.view">
        <field name="name">menu.allergen.tree</field>
        <field name="model">menu.allergen</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="description"/>
            </list>
        </field>
    </record>

    <record id="view_menu_allergen_form" model="ir.ui.view">
        <field name="name">menu.allergen.form</field>
        <field name="model">menu.allergen</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="description"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Views: Dietary Tag -->
    <record id="view_menu_dietary_tag_tree" model="ir.ui.view">
        <field name="name">menu.dietary.tag.tree</field>
        <field name="model">menu.dietary.tag</field>
        <field name="arch" type="xml">
            <list>
                <field name="name"/>
                <field name="color" widget="color_picker"/>
            </list>
        </field>
    </record>

    <record id="view_menu_dietary_tag_form" model="ir.ui.view">
        <field name="name">menu.dietary.tag.form</field>
        <field name="model">menu.dietary.tag</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name"/>
                        <field name="color" widget="color_picker"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Views: Item -->
    <record id="view_menu_item_tree" model="ir.ui.view">
        <field name="name">menu.item.tree</field>
        <field name="model">menu.item</field>
        <field name="arch" type="xml">
            <list>
                <field name="sequence"/>
                <field name="name"/>
                <field name="code"/>
                <field name="category_id"/>
                <field name="recipe_id"/>
                <field name="price"/>
                <field name="uom_id"/>
                <field name="serving_size"/>
                <field name="available"/>
                <field name="is_featured"/>
                <field name="spice_level"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <record id="view_menu_item_form" model="ir.ui.view">
        <field name="name">menu.item.form</field>
        <field name="model">menu.item</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                        </button>
                        <button name="action_open_recipe" type="object" class="oe_stat_button" icon="fa-book" invisible="not recipe_id">
                            <field name="recipe_id" widget="statinfo" string="Recipe"/>
                        </button>
                    </div>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="code"/>
                            <field name="category_id"/>
                            <field name="recipe_id"/>
                            <field name="sequence"/>
                            <field name="image_1920" widget="image" class="oe_avatar"/>
                        </group>
                        <group>
                            <field name="available"/>
                            <field name="is_featured"/>
                            <field name="is_new"/>
                            <field name="is_popular"/>
                            <field name="active"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Pricing &amp; Units" name="pricing">
                            <group>
                                <group string="Pricing">
                                    <field name="price"/>
                                    <field name="cost_price"/>
                                </group>
                                <group string="Units &amp; Quantity">
                                    <field name="uom_id"/>
                                    <field name="serving_size"/>
                                    <field name="min_order_qty"/>
                                    <field name="max_order_qty"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Timing" name="timing">
                            <group>
                                <group string="Time Information">
                                    <field name="prep_time"/>
                                    <field name="cooking_time"/>
                                    <field name="total_time" readonly="1"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Dietary &amp; Allergen Info" name="dietary">
                            <group>
                                <group string="Dietary Tags">
                                    <field name="dietary_tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                    <field name="is_vegetarian"/>
                                    <field name="is_vegan"/>
                                    <field name="is_halal"/>
                                    <field name="is_gluten_free"/>
                                    <field name="spice_level"/>
                                </group>
                                <group string="Allergens">
                                    <field name="allergen_ids" widget="many2many_tags"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Nutrition" name="nutrition">
                            <group>
                                <group string="Nutritional Information">
                                    <field name="calories"/>
                                    <field name="protein"/>
                                    <field name="carbs"/>
                                    <field name="fat"/>
                                </group>
                            </group>
                            <group>
                                <field name="ingredients"/>
                            </group>
                        </page>
                        
                        <page string="Availability" name="availability">
                            <group>
                                <field name="available_from"/>
                                <field name="available_until"/>
                                <field name="tags"/>
                            </group>
                        </page>
                        
                        <page string="Descriptions" name="descriptions">
                            <group>
                                <field name="short_description" placeholder="Brief description for menu cards"/>
                                <field name="description" placeholder="Full detailed description"/>
                            </group>
                        </page>
                        
                        <page string="Notes" name="notes">
                            <group>
                                <field name="customer_notes" placeholder="Information visible to customers"/>
                                <field name="preparation_notes" placeholder="Kitchen staff instructions"/>
                                <field name="internal_notes" placeholder="Internal notes (not visible to customers)"/>
                            </group>
                        </page>
                        
                        <page string="Statistics" name="stats">
                            <group>
                                <group string="Performance">
                                    <field name="item_count"/>
                                    <field name="rating"/>
                                    <field name="review_count"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_menu_category" model="ir.actions.act_window">
        <field name="name">Menu Categories</field>
        <field name="res_model">menu.category</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_menu_allergen" model="ir.actions.act_window">
        <field name="name">Allergens</field>
        <field name="res_model">menu.allergen</field>
        <field name="view_mode">list,form</field>
    </record>

    <record id="action_menu_dietary_tag" model="ir.actions.act_window">
        <field name="name">Dietary Tags</field>
        <field name="res_model">menu.dietary.tag</field>
        <field name="view_mode">list,form</field>
    </record>

    <!-- Menus -->
    <menuitem id="menu_root" name="Menu Management" sequence="20"/>
    <menuitem id="menu_category" name="Categories" parent="menu_root" action="action_menu_category" sequence="10"/>
    <menuitem id="menu_item" name="Menu Items" parent="menu_root" action="action_menu_item" sequence="20"/>
    <menuitem id="menu_config" name="Configuration" parent="menu_root" sequence="30"/>
    <menuitem id="menu_allergen" name="Allergens" parent="menu_config" action="action_menu_allergen" sequence="10"/>
    <menuitem id="menu_dietary_tag" name="Dietary Tags" parent="menu_config" action="action_menu_dietary_tag" sequence="20"/>

    <!-- Inherit Recipe Form View to add Menu Items button -->
    <record id="view_recipe_form_inherit_menu_items" model="ir.ui.view">
        <field name="name">recipe.form.inherit.menu.items</field>
        <field name="model">recipe.recipe</field>
        <field name="inherit_id" ref="recipe.view_recipe_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_open_menu_items" type="object" class="oe_stat_button" icon="fa-cutlery" invisible="menu_item_count == 0">
                    <field name="menu_item_count" widget="statinfo" string="Menu Items"/>
                </button>
            </xpath>
        </field>
    </record>
</odoo>